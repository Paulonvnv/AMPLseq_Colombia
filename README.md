# Micro-Haplotype (MHap) Analysis
The purpose of this repository is to introduce researchers at the Laboratory of Genomic Epidemiology of Malaria at Harvard university in the analysis of genotyping information generated through amplicon sequencing (also called Microhaplotype genotyping). This covers:

1. Importing and handling tables in CIGAR format in R environment.

2. Adding metadata.

3. Performance of the genotyping process.

4. Molecular surveillance of drug resistance.

5. Monitoring transmission intensity.

6. Measuring geographic connectivity.

The repository contains a set of functions created to upload and manipulate the genotype information stored in a .tsv table in CIGAR format that has been generated by the [malaria-amplicon-pipeline](https://github.com/broadinstitute/malaria-amplicon-pipeline) of our lab. All those functions and the required libraries are in the R scripts `amplseq_functions.R` and amplseq_required_libraries.R, and an additional function for the estimation of IBD is the .ccp file `hmmloglikelihood.cpp`. Some of the functions requires additional inputs from the reference strains or alleles associated with drug resistance. That additional information is stored in the folder `reference`.

A RMarkdown tutorial (`MHap_Tutorial.rmd`) has been created to introduce the final users to all the set of functions. To run this tutorial a data set of 1300 samples is stored in the folder `data`. The output of the malaria-amplicon-pipeline is stored in the folder `sequencing_data` and the metadata of the samples is in the file `metadata.csv`. The samples comes from a collaboration with the group of Caucaseco, which has collected samples of *P. falciparum* from 2020 to 2022 in 5 municipalities located in Colombia. The data set has geographic information, however this information is encoded to protect the geographic origin of the participants.

For people not familiarized with RMarkdown, all tutorials are also found in our wiki.

$$T_i = \lambda$$

$$\begin{array}{c|c:c:c:c:c:c} \text{sampleID}&Gene_1,Allele_1&Gene_1,Allele_2&...&Gene_1,Allele_k&... & Gene_m, Allele_{k_m}\\ \hline ID_1 & \text{Read counts} &&& \\ \hdashline ... &&&&\\ \hdashline ID_n &&&& \end{array}$$
